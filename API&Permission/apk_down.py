import threadpool
import time
from urllib.request import urlretrieve
import requests
cout=500
def apk_down(url):
    global cout
    try:
        f = requests.get(url,headers)
        file_size = int(f.headers['content-length'])
        if file_size >= 1000000:
            with open(str(cout)+'.apk', 'wb') as apk:
              apk.write(f.content)
            apk.close()
            cout=cout+1
            print("done.")
        else:
          print("文件小不予下载")   
    except Exception as e:
        pass

def rendUrl():
  f=open("apk_download_links.txt","r")
  url_conent=[]
  line=f.readline()
  while line:
    url_conent.append(line.strip("\n"))
    line=f.readline()
  return url_conent
if __name__ == '__main__':
    headers = {
            'User-Agent': 'Mozilla/5.0 (Linux; U; Android 4.0.3; zh-cn; M032 Build/IML74K) '
                          'AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30',
            'Connection': 'keep-alive', }
    url_list=rendUrl()
    start_time = time.time()
    pool = threadpool.ThreadPool(20)
    requests1 = threadpool.makeRequests(apk_down, url_list)
    [pool.putRequest(req) for req in requests1]
    pool.wait()
    print ('%d second'% (time.time()-start_time))
