# Android-malware-detection
Using machine learning to detect Android malware

------
## 前置
> * 由于移动互联网的不断发展，Android系统已经成为最受欢迎的移动操作系统之一。人们在移动互联网所花费的时间远远大于PC端，为此，针对Android应用的大量恶意软件开始层出不穷。
> * 针对上述问题，本文设计出了基于机器学习的Android恶意程序检测方法，主要包括：
> * 1) 基于Android的专家知识，选取敏感API和权限信息作为特征建立了机器学习分类模型，通过不同分类算法的多次交叉验证测试，取得了平均90%左右的准确率。
> * 2) 采用更加客观的OpCode N-gram特征来构建机器学习的分类模型。使用多种分类算法和交叉验证，该分类模型在最佳状态时取得98%的准确率

## 数据来源
> * 机器学习分类模型的训练需要大量恶意APK样本和正常APK样本。本文的正常APK样本均是用Python爬虫脚本从第三方市场下载得来，在使用这些正常APK样本前，先将这些APK上传到国内知名查杀网站进行扫描查杀，确保这些APK没有恶意行为。最终得到正常APK的数量是698个。
> * 恶意APK样本从VirusShare官网申请下载。VirusShare是恶意软件样本的存储库，可为安全研究人员，事件响应人员，取证分析人员提供恶意APK，最终获取了756个恶意APK样本
## 基于敏感API和权限特征的检测算法流程
> * APK集合由全部恶意样本和正常样本组成，是构建分类模型的输入数据集
> * 批量反编译通过Python脚本调用APKtool实现
> * Smali文集集合是反编译全部APK后得到的相关文件，其中一个APK会对应一个Smali文件
> * 特征提取通过KMP字符串匹配算法在Smali文件集合中搜寻预先指定的相关特征，匹配成功该特征设置为1，否则设置成0
<img src="https://github.com/Flynn-ML2019/Android-malware-detection/blob/master/API%26Permission/5756AD69-9FEA-46A8-9DE9-A427AD82ABBD.png" alt="Sample"  width="250" height="440">

## 基于OpCode N-gram特征的检测算法流程
> * 基于method的逐行解析算法指的是，以源代码中的方法为一个原子单位，在原子单位中逐行匹配转换规则表的规则。一个APK样本最终形成一个N-gram集合
> * 假如某APK的N-gram集合是MVMPV，自定义分割中N值取2，则分割后的结果是MV、VM、 MP、 PV，将此结果加入到整个N-gram Opcode特征集合中，并置此APK对MV、VM、 MP、 PV的值为1
<img src="https://github.com/Flynn-ML2019/Android-malware-detection/tree/master/n-gram/C5BF235C-007E-4C91-BE1D-3B5BFAC893C4.png" alt="Sample"  width="250" height="440">

## 将提取的部分敏感API特征如图所示
<img src="https://github.com/Flynn-ML2019/Android-malware-detection/tree/master/n-gram/46F3BF94-29C4-480C-86B7-1C152D8C54D1.png"  width="250" height="440">
